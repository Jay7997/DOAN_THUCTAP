<!DOCTYPE html>
<html>
<head>
    <title>Test Comment Submission</title>
    <meta name="csrf-token" content="test-token">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Test Comment Submission</h1>
    
    <form id="comment-form">
        <div>
            <label for="comment-name">Name:</label>
            <input type="text" id="comment-name" required>
        </div>
        <div>
            <label for="comment-rating">Rating:</label>
            <select id="comment-rating" required>
                <option value="100">5 stars</option>
                <option value="80">4 stars</option>
                <option value="60">3 stars</option>
                <option value="40">2 stars</option>
                <option value="20">1 star</option>
            </select>
        </div>
        <div>
            <label for="comment-content">Comment:</label>
            <textarea id="comment-content" required></textarea>
        </div>
        <button type="submit">Submit Comment</button>
    </form>
    
    <script>
        $(document).ready(function() {
            // Log all AJAX requests to see what URLs are being called
            $(document).ajaxSend(function(event, xhr, settings) {
                console.log('AJAX Request:', settings);
            });
            
            // Log all fetch requests to see what URLs are being called
            const originalFetch = window.fetch;
            window.fetch = function(input, init) {
                console.log('Fetch Request:', input, init);
                return originalFetch.apply(this, arguments);
            };
            
            // Handle form submission
            $('#comment-form').submit(function(e) {
                e.preventDefault();
                
                var name = $('#comment-name').val();
                var rating = $('#comment-rating').val();
                var content = $('#comment-content').val();
                var productId = 60009; // Test product ID
                
                // Test using fetch to proxy route
                fetch(`/api/proxy-binhluan/${productId}/add`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                    },
                    body: JSON.stringify({
                        nguoidang: name,
                        rating: rating,
                        noidungbinhluan: content
                    })
                })
                .then(res => res.json())
                .then(data => {
                    console.log('Success:', data);
                    alert('Comment submitted successfully!');
                })
                .catch(err => {
                    console.log('Error:', err);
                    alert('Error submitting comment: ' + err);
                });
                
                // Test using direct API call (this is what we want to avoid)
                // This is just for testing purposes to see if this is what's happening
                /*
                $.ajax({
                    url: `https://demodienmay.125.atoz.vn/ww1/save.binhluan.asp`,
                    method: 'GET',
                    data: {
                        userid: '',
                        pass: '',
                        id: productId
                    },
                    success: function(data) {
                        console.log('Direct API call success:', data);
                    },
                    error: function(xhr, status, error) {
                        console.log('Direct API call error:', error);
                    }
                });
                */
            });
        });
    </script>
</body>
</html>